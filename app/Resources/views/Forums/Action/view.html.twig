{% extends ('::layout.html.twig')%}
{% block title %}{{ sujet.titre }}{% endblock %}
{% block body %}
<div class="container">
  <div class="row">
    <div class="col-xs-12">
      <a href="{{path('forums')}}" class="btn btn-info">Retour à l'accueil</a>
      <!-- Les outils de modération ne s'affiche qu'aux modérateurs -->
      {% if is_granted('ROLE_MODERATEUR')%}
        <div class="row">
          <hr />
          <h4 class="text-center">Outils de modération</h4>
          <hr />
              <p class="text-center">
                <a href="{{ path('forums_delete', {'id': sujet.id}) }}" class="btn btn-danger">Supprimer ce sujet</a>
              </p>
            <p class="text-center">
              <a href="{{path('forums_update', {'id': sujet.id})}}" class="btn btn-info">Modifier ce sujet</a>
            </p>
            <p class="text-center">
              <a href="#" class="btn btn-success">fermer ce sujet</a>
            </p>
        </div>
        <hr />
      {% endif %}
      <h3 class="text-center">{{ sujet.titre }}</h3>
      <br>
      <h4 class="text-center">Par <strong>{{ sujet.auteur }}</strong>, le {{ sujet.dateCreation|date('d/m/Y') }}</h4>
      <hr />
      <p class="text-center">{{ sujet.contenu|raw }}</p>
      <br>
      <br>
    </div>
    <div class="row">
      <h4 class="text-center">Commentaires</h4>
      <hr />
      <!-- On affiche les commentaires liés au sujet, si le visiteur est modérateur on affiche une vue adaptée -->
      {% for msg in message %}
        <div class="row">
          {% if is_granted('ROLE_MODERATEUR')%}
            <div class="col-lg-2">
              <p class="text-center"><strong>{{ msg.auteur }}</strong></p>
              <p class="text-center">{{ msg.dateMessage|date('d/m/Y') }}</p>
            </div>
            <div class="col-lg-8">
              <p class="text-center">{{ msg.contenu|raw }}</p>
            </div>
            <div class="col-lg-2">
              <p class="text-center"><a href="{{path('forums_delete_message', {'id': msg.id} )}}" class="btn btn-danger">Supprimer</a></p>
              <p class="text-center"><a href="#" class="btn btn-info">Modifier</a></p>
            </div>
          {% else %}
            <div class="col-lg-2">
              <p class="text-center"><strong>{{ msg.auteur }}</strong></p>
              <p class="text-center">{{ msg.dateMessage|date('d/m/Y') }}</p>
            </div>
            <div class="col-lg-10">
              <p class="text-center">{{ msg.contenu|raw }}</p>
            </div>
          {% endif %}
        </div>
        <hr />
      {% endfor %}
    </div>
    <!-- Le visiteur ne pourra commenter que si il est connecté -->
    {% if is_granted('IS_AUTHENTICATED_FULLY')%}
    <div class="row text-center">
      <div class="well">
        {{ form_start(form, {'attr': {'class': 'form-horizontal'}}) }}
        {{ form_errors(form) }}
        <div class="form-group">
          {{ form_label(form.contenu, "Contenu", {'label_attr': {'class': 'control-label'}}) }}
          {{ form_errors(form.contenu) }}
          {{ form_widget(form.contenu, {'attr': {'class': 'form-control'}}) }}
        </div>
        <div class="form-group">
          {{ form_widget(form.save, {'attr': {'class': 'btn btn-danger'}})}}
        </div>
        {{ form_end(form) }}
      </div>
    </div>
    {% endif %}
  </div>
</div>
{% endblock %}
